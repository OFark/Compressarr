@page "/FFmpeg"

@inject IApplicationService ApplicationService
@inject IPresetManager PresetManager
@inject ILayoutService LayoutService

@if (appReady)
{
    <MudExpansionPanels>

        @foreach (var preset in PresetManager.Presets)
        {
            <PresetView preset="preset" />

        }
        <PresetView preset="@newPreset" NewPreset="true" OnAdd="addPreset"></PresetView>
    </MudExpansionPanels>
}
else
{
    
    <MudContainer MaxWidth="MaxWidth.Medium">
        <MudSkeleton Width="30%" Height="42px;" />
        <MudSkeleton Width="80%" />
        <MudSkeleton Width="100%" />
        <MudSkeleton Width="100%" />
        <MudSkeleton Width="100%" />
    </MudContainer>
}


@code {

    private FFmpegPreset newPreset = new();

    private bool appReady;

    
    protected async override Task OnInitializedAsync()
    {
        LayoutService.OnStateChanged += LayoutService_OnStateChanged;

        await ApplicationService.InitialisePresets;
        appReady = true;

        await base.OnInitializedAsync();
    }

    private void FFmpegInitialiser_OnReady(object sender, EventArgs e)
    {
        LayoutService.RaiseChange();
    }

    private async void LayoutService_OnStateChanged(object sender, EventArgs e)
    {
        await InvokeAsync(StateHasChanged);
    }

    private void addPreset()
    {
        newPreset = new();
    }
}