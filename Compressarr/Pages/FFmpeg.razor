@page "/FFmpeg"

@inject IFFmpegManager FFmpegManager
@inject IFFmpegInitialiser FFmpegInitialiser
@inject ILayoutService LayoutService

@if (FFmpegInitialiser.Ready)
{
    <MudExpansionPanels>

        @foreach (var preset in FFmpegManager.Presets)
        {
            <PresetView preset="preset" />

        }
        <PresetView preset="@newPreset" NewPreset="true" OnAdd="addPreset"></PresetView>
    </MudExpansionPanels>
}
else
{
    
    <MudContainer MaxWidth="MaxWidth.Medium">
        <MudSkeleton Width="30%" Height="42px;" />
        <MudSkeleton Width="80%" />
        <MudSkeleton Width="100%" />
        <MudSkeleton Width="100%" />
        <MudSkeleton Width="100%" />
    </MudContainer>
}


@code {

    private FFmpegPreset newPreset = new();

    //todo: option to keep current container

    protected override void OnInitialized()
    {
        FFmpegInitialiser.OnReady += FFmpegInitialiser_OnReady;

        base.OnInitialized();
    }

    protected async override Task OnInitializedAsync()
    {
        LayoutService.OnStateChanged += LayoutService_OnStateChanged;

        await base.OnInitializedAsync();
    }

    private void FFmpegInitialiser_OnReady(object sender, EventArgs e)
    {
        LayoutService.RaiseChange();
    }

    private async void LayoutService_OnStateChanged(object sender, EventArgs e)
    {
        await InvokeAsync(StateHasChanged);
    }

    private void addPreset()
    {
        newPreset = new();
    }
}